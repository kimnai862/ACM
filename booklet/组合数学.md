## 组合数学

 $C_{n+1}^{m}=C_{n}^{m}+C_{n}^{m-1}$

 $\sum_{i=0}^{k}C_{n}^{i}=C_{n+1}^{k+1}$

### 错排公式

D(n) = (n-1) [D(n-2) + D(n-1)] 

D(n) = n! [(-1)^2/2! + … + (-1)^(n-1)/(n-1)! + (-1)^n/n!]. 

### 圆排列

从n个不同[元素](https://baike.baidu.com/item/%E5%85%83%E7%B4%A0/29645)中不重复地取出m（1≤m≤n）个元素在一个圆周上，叫做这n个不同元素的圆排列。如果一个m-圆排列旋转可以得到另一个m-圆排列，则认为这两个圆排列相同。  

n个不同元素的m-圆排列个数N为 $\frac{n!}{(n-m)!\times m}$

### lucas定理

C(n,m)%p=C(n/p,m/p)*C(n%p,m%p)%p 

### 斯特林公式

 $n!\approx\sqrt{2\pi n}(\frac{n}{e})^n$ 应用：求n!的位数

### 第一类斯特林数 s(p,k)

 $s(p,k)$ ：p个人分成k组做环排列的方法数目

 $s(p,k) = (p - 1) \ast s(p - 1,k) + s(p - 1,k - 1) ,1<=k<=p- 1 $

 边界条件：$s(p,0) = 0 ,p>=1 $        $s(p,p)=1,p>=0$

 应用：

​	求自然数幂和： $\sum_{i=0}^{n}i^{k}$

 			 $P_{n}^{k}=n\ast (n-1)\ast ...\ast (n-k+1)$

 展开：		 $P_{n}^{k}=s(k,k)n^{k}-s(k,k-1)n^{k-1}...$

​			 $P_{n}^{k}=\sum_{i=0}^{k}(-1)^{k-i}s(k,i)n^{i}$

​	所以第一类斯特林数是排列数公式展开式的系数

​	显然左边是k个只有0次和1次的系数为(1,-(i-1))的多项式相乘

​	 可以用分治FFT在nlog^2(n)时间内求s(n,0),s(n,1),...,   

设：		 $S_{k}(n)=\sum_{i=0}^{n}i^{k}$

​		 $C_{n}^{k}=\frac{P_{n}^{k}}{k!}=\frac{\sum_{i=0}^{k}(-1)^{k-i}s(k,i)n^{i}}{k!}$	

​		 $n^{k}=C_{n}^{k}k! - \sum_{i=0}^{k-1}(-1)^{k-i}s(k,i)n^{i}$	

​		 $S_{k}(n)=\sum_{i=0}^{n}i^{k}$	 	   

​			     $=\sum_{i=0}^{n}(C_{i}^{k}k!-\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)i^{j})$		 

​			     $=k!\sum_{i=0}^{n}C_{i}^{k}-\sum_{i=0}^{n}\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)i^{j}$		  			 

​			      $=k!C_{n+1}^{k+1}-\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)S_{j}(n)$		   

​			     $=\frac{P_{n+1}^{k+1}}{k+1}-\sum_{j=0}^{k-1}(-1)^{k-j}s(k,j)S_{j}(n)$	

​		可以$O(k^{2})$递推$s_{k}(n)$ 


​					    

### 第二类斯特林数 S(p,k)

 $S(p,k)$ ：p个不同的小球放进k个相同的非空的盒子的方法数

 $S(p,k) = k \ast S(p-1,k) + S(p-1,k-1) , 1<=k<=p-1$

 边界条件： $S(p,p)=1,p>=0$     $S(p,0)=0,p>=1$

​		 $S(n,m)=\frac{1}{m!}\sum_{k=0}^{m}(-1)^{k}C(m,k)(m-k)^{n}$

​		该式是个卷积，可以在nlogn时间内求出S(n,0),S(n,1),...

 应用：

​	 $n^{k}=\sum_{i=0}^{k}S(k,i)P_{n}^{i}$     

​	      $=\sum_{i=0}^{k}S(k,i)C_{n}^{i}i！$	  

​	      $=\sum_{i=0}^{k}S(k,i)i!(C_{n-1}^{i}+C_{n-1}^{i-1})$    

​	      $=(n-1)^{k}+\sum_{i=1}^{k}S(k,i)i!C_{n-1}^{i-1}$

### 贝尔数

 定义：第n个bell数表示集合{1,2,3,...,n}的划分方案数，$B[0]=1$

 $B_{n+1}=\sum_{k=0}^{n}C(n,k)B_{k}$

 $B_{n}=\sum_{m=0}^{n}S(n,m)$

​	 $=\sum_{m=0}^{n}\frac{1}{m!}\sum_{k=0}^{m}(-1)^kC(m,k)(m-k)^n$

​	 $=\sum_{m=0}^{n}\sum_{k=0}^{m}\frac{(-1)^k}{k!}\ast \frac{(m-k)^n}{(m-k)!}$

​	设$A_i=\frac{(-1)^i}{i!}, B_i=\frac{i^n}{i!}$

​	 $=\sum_{m=0}^n\sum_{k=0}^mA_kB_{m-k}$

​	 $=\sum_{i=0}^nA_i\sum_{m=0}^{n-i}B_m$

​	 nlogn预处理即可得到$B_n$，写法简便

 指数生成函数： $\sum_{n=0}^{\infty} \frac{B_{n}}{n!}x^{n}=e^{e^{x}-1}$

 将$e^x-1$泰特展开后多项式求exp即可在nlogn的时间内求贝尔数的前n项和

### 伯努利数 

  $B_0=1,B_n=-\frac{1}{n+1}(C_{n+1}^{0}B_0+C_{n+1}^1B_1+...+C_{n+1}^{n-1}B_{n-1})$ 

 指数生成函数：

​	 $G_e(x)=\sum_{i=0}^{\infty}\frac{B_i}{i!}x^i=\frac{x}{e^x-1}=\frac{x}{\sum_{i=1}^{\infty}\frac{x^i}{i!}}=\frac{1}{\sum_{i=0}^{\infty}\frac{x^i}{(i+1)!}}$

​	可以用FFT多项式求逆在nlogn的时间内求前n项

应用：自然数幂求和

​	 $S_{m}(n)=\sum_{k=1}^nk^m=\frac{1}{m+1}\sum_{k=0}^m(-1)^kC(m+1,k)B_kn^{m+1-k}$


​	

### 五边形数定理

​	 $\phi(x)=\prod_{n=1}^{\infty}(1-x^n)=\sum_{-\infty}^{\infty}(-1)^{k}x^{\frac{k(3k-1)}{2}}=1+\sum_{k=1}^{\infty}(-1)^{k}x^{\frac{k(3k\pm 1)}{2}}$

### 整数拆分问题

 $P(x)=(1+x^1+x^2+..)(1+x^2+x^4+...)(1+x^3+x^6+...)...$

​          $=\prod_{i=0}^{\infty}\frac{1}{1-x^i}=P_{x}(0)x^0+P_{x}(1)x^1+P_{x}(2)x^2+...+P_{x}(n)x^{n}+...$

n的拆分数为$P_{x}(n)$

​	 $\frac{1}{\phi(x)}=\sum_{i=0}^{\infty}P_{x}(i)x^i$

​	 $1=\phi(x)\sum_{i=0}^{\infty}P_{x}(i)x^i$

​	 $=(1-x-x^2+x^5+...)(P_{x}(0)+P_{x}(1)x+P_{x}(2)x^{2}+P_{x}(3)x^3+...)$

​	  $P_{x}(n)=P_{x}(n-1)+P_{x}(n-2)-P_{x}(n-5)-P_{x}(n-7)+...$

​	 $\frac{i(3i-1)}{2}\leq n$的i的个数不超过$\sqrt{n}$个 计算$P_{x}(n)$复杂度为$O(n\sqrt{n})$

 **约束条件1：** 拆分出来的每种数的个数不能大于等于k

 $(1+x^1+x^2+...+x^{k-1})(1+x^2+x^4+...+x^{2(k-1)})=\prod_{i=0}^{\infty}\frac{1-x^{ki}}{1-x^i}=\frac{\phi(x^k)}{\phi(x)}=\phi(x^k)P(x)$

 $\phi(x^k)P(x)=(1-x^k-x^{2k}+x^{5k})(P_{x}(0)+P_{x}(1)x^1+P_{x}(2)x^2+P_{x}(3)x^3+...)$

 $ans=F_{k}(n)=P_{x}(n)-P_{x}(n-k)-P_{x}(n-2k)+P_{x}(n-5k)+...$

### 球盒问题（n个球，m个盒）

 **约束条件1：**球无区别 盒无区别 允许为空

​	整数拆分问题 答案为$x^n$的系数

 **约束条件2：**球无区别 盒无区别 不允许为空

​	整数拆分问题 答案为$x^{n-m}$的系数

 **约束条件3：**球无区别 盒有区别 允许为空

​	隔板法 答案为 $C(m+n-1,m-1)$

 **约束条件4：**球无区别 盒有区别 不允许为空

​	隔板法 答案为 $C(n-1,m-1)$

 **约束条件5：**球有区别 盒有区别 允许为空

​	指数型母函数 答案为 $m^n$

 **约束条件6：**球有区别 盒有区别 不允许为空

​	指数型母函数 答案为 $\sum_{k=0}^{m}(-1)^{k}C(m,k)(m-k)^n$

 **约束条件7：**球有区别 盒无区别 不允许为空

​	第二类斯特林数 答案为 $S(n,m)=\frac{1}{m!}\sum_{k=0}^{m}(-1)^{k}C(m,k)(m-k)^n$

 **约束条件8：**球有区别 盒无区别 允许为空

​	第二类斯特林数 答案为 $S(n,1)+S(n,2)+S(n,3)+..+S(n,min(n,m))$



### 生成函数

当 $A(n+k)=C_{1}A(n+k-1)+C_{2}A(n+k-2)+...+C_{k}A(n)$

 ${A(n)}$成为k阶常系数线性递推数列

多项式$x^{k}=C_{1}x^{k-1}+C_{2}x^{k-2}+...+C_{k}$为特征多项式

 $A(n)=d_{1}x_{1}^{n}+d_{2}x_{2}^{n}+...+d_{k}x_{k}^{n}$

 $d_{1},d_{2},...,d_{k}$为待定系数

如果有重根 $x_{1}=x_{2}=x_{3}$ 对应项为 $(d_{1}+d_{2}n+d_{3}n^{2})x_{1}^{n}$


​	

斐波那契数列

​	 $S_{n}=f(0)+f(1)+...+f(n)=f(n+2)-1$

​	斐波那契数f(n)是偶数当且仅当n能被3整除

​	 $f(n)=\frac{1}{\sqrt{5}}(\frac{1+\sqrt{5}}{2})^{n}-\frac{1}{\sqrt{5}}(\frac{1-\sqrt{5}}{2})^{n}$	

​	 $f(n)=C(n-1,0)+C(n-2,1)+...+C(n-t,t-1)$   $t=\lfloor\frac{n+1}{2}\rfloor$

`

 $(1-x)^{-k}=\sum_{n=0}^{\infty}C(k+n-1,k-1)x^{n}$

 $(1+x^{1}+x^{2}+...+x^{n-1})^{m}=(\frac{1-x^{n}}{1-x})^{m}=\frac{(1-x^n)^{m}}{(1-x)^{m}}=(1-x^{n})^{m}(1-x)^{-m}$

 $g_{n}(x)=1(1+x)(1+x+x^{2})...(1+x+x^{2}+...+x^{n-1})=\frac{\prod_{j=1}^{n}(1-x^{j})}{(1-x)^{n}}$

指数生成函数常用公式
	 $e^{x}=\sum_{n=0}^{\infty}\frac{x^{n}}{n!}=1+x+\frac{x^2}{2!}+...+\frac{x^{n}}{n!}+...$

​	 $g^{(e)}(x)=1+x+\frac{x^{2}}{2!}+\frac{x^{3}}{3!}+...=e^{x}$

​	 $g^{(e)}(x)=1-x+\frac{x^2}{2!}-\frac{x^3}{3!}+...=e^{-x}$

​	 $g^{(e)}(x)=1+\frac{x^2}{2!}+\frac{x^4}{4!}+\frac{x^6}{6!}+...=\frac{e^x+e^{-x}}{2}$

​	 $g^{(e)}(x)=x+\frac{x^{3}}{3!}+\frac{x^5}{5!}+\frac{x^7}{7!}+...=\frac{e^x-e^{-x}}{2}$	

​	 $ln(1+x)=x-\frac{1}{2}x^2+\frac{1}{3}x^3+o(x^3)$

​	 $sinx=x-\frac{1}{3!}x^3+\frac{1}{5!}x^5+o(x^5)$

​	 $arcsinx=x+\frac{1}{2}\times \frac{x^3}{3}+\frac{1\times 3}{2\times 4}\times \frac{x^5}{5}+\frac{1\times 3\times 5}{2\times 4\times 6}\times \frac{x^7}{7}+o(x^7)$

​	 $cosx=1-\frac{1}{2!}x^2+\frac{1}{4!}x^4+o(x^4)$

​	 $\frac{1}{1-x}=1+x^2+x^3+o(x^3)$

​	 $(1+x)^a=1+\frac{a}{1!}x+\frac{a(a-1)}{2!}x^2+\frac{a(a-1)(a-2)}{3!}x^3+o(x^3)$

一道例题：用红黄蓝三色给1*n的棋盘着色，要求红格数是偶数，且至少有一个蓝格的着色方法数

​	 $h_{1}(x)=1+\frac{x^2}{2!}+\frac{x^4}{4!}+\frac{x^6}{6!}+...$

​	 $h_{2}(x)=1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+...$

​	 $h_{3}(x)=x+\frac{x^2}{2!}+\frac{x^3}{3!}+...$

​	 $g^{(e)}(x)=h_{1}(x)h_{2}(x)h_{3}(x)$

​	  $=(1+\frac{x^2}{2!}+\frac{x^4}{4!}+\frac{x^6}{6!}+...)(1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+...)(x+\frac{x^2}{2!}+\frac{x^3}{3!}+...)$ 

​	 $=\frac{e^x+e^{-x}}{2}e^x(e^x-1)=\frac{e^{3x}-e^{2x}+e^x+1}{2}=-\frac{1}{2}+\sum_{n=0}^{\infty}(\frac{3^n-2^n+1}{2})\frac{x^n}{n!}$

​	 $ans=h_{n}=\frac{3^n-2^n+1}{2}$


​			
